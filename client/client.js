!function(){var t={so:null,isFirstConnect:!0,user:{uname:null},gameInfo:{user:null},connect:function(t,n){var e=n||80,s=this;null==this.so?(this.so=io.connect("http://"+t+":"+e,{reconnect:!1}),this.so&&(this.so.on("connect",function(){s.doConnect()}),this.so.on("error",function(t){this.so=null,alert("服務器連接失敗!")}))):this.so.socket.reconnect()},isOperUser:function(){return this.user.uname==this.gameInfo.user.uname},login:function(n){this.so.emit("login",{uname:this.user.uname},function(t){n(t)})},doConnect:function(){this.isFirstConnect?(this.isFirstConnect=!1,this.bindEvent()):this.so.socket.reconnect()},bindEvent:function(){var n=this;this.so.on("message",function(t){n.doMessage(t)}),this.so.on("startDraw",function(t){n.startDraw(t)}),this.so.on("drawing",function(t){n.drawing(t)}),this.so.on("paintUpdate",function(t){n.paintUpdate(t)}),this.so.on("updateUserInfo",function(t){n.doUpdateUserInfo(t)}),this.so.on("questionReady",function(t){n.doQuestionReady(t)}),this.so.on("startQuestion",function(t){n.doStartQuestion(t)}),this.so.on("processQuestion",function(t){n.doProcessQuestion(t)}),this.so.on("hint",function(t){n.doHint(t)}),this.so.on("award",function(t){n.doAward(t)}),this.so.on("endquestion",function(t){n.doEndquestion(t)}),this.so.on("gameover",function(t){n.doGameOver(t)})},doMessage:function(t){
	$("#msgArea").append(t).append("<br/>"),$("#msgArea").scrollTop($("#msgArea")[0].scrollHeight)},updateUser:function(n,t){var e=this;n.uname==this.user.uname&&(this.user=n);var s=$("<div id='ulx' class='ulx'></div>"),o=$("<div id='u_"+n.uname+"' class='uready'><div id='aw_"+n.uname+"' class='award'></div></div>"),i=$("<div id='uc_"+n.uname+"' class='ugo'></div>");s.append("<div style='overflow:hidden'>"+n.uname+"</div>").append(o).append(i),$("#userArea").append(s),i.text(n.score),n.uname==this.user.uname&&0==t&&(i.text("GO!"),i.on("click",function(){e.so.emit("gameStart",null,function(t){i.off("click"),i.text(n.score)})}))},doUpdateUserInfo:function(t){var n=t;$("#userArea").empty();for(var e=0;e<n.length;e++)this.updateUser(n[e],e)},sendMsg:function(t){this.so.send(t)},emitStartDraw:function(t){this.so.emit("startDraw",t)},emitDrawing:function(t){this.so.emit("drawing",t)},emitPaintUpdate:function(t){this.so.emit("paintUpdate",t)},startDraw:function(t){canvasAction.fire("onStartDraw",t)},drawing:function(t){canvasAction.fire("onDrawing",t)},paintUpdate:function(t){canvasAction.fire("onPaintUpdate",t)},doQuestionReady:function(t){this.ReadyEffect(t)},doStartQuestion:function(t){var n=t[0].user,e="現在由:"+n.uname+"開始畫畫";if(this.gameInfo=t[0],canvasAction.clear(),$("#ulx div[id^=u_]").each(function(){
	$(this).attr("class","uready")}),$("#u_"+n.uname).attr("class","uoper"),$("#Div_opt").hide(),$("#effect").show(),$("#TimeCountNum").show(),$("#TimeCountNum").text(t[1]),$("#roundNum").text("第"+this.gameInfo.round+"/"+t[2]+"輪"),this.user.uname==n.uname){var s="請按照題目畫圖,題目:<span style='color:red'>"+t[0].askToUser.data+"</span>";$("#askToUser").html(s),$("#Div_opt").show()}else $("#askToUser").text(e);$("#msgArea").append(e+"<br/>"),$("#msgArea").scrollTop($("#msgArea")[0].scrollHeight)},showMessage:function(t){var n=$("#hb"),e=n.width(),s=n.height(),o=n.offset().left,i=n.offset().top,a=$("#msg");a.text(t),a.css("left",o+.5*(e-300)),a.css("top",i+.5*(s-130)),$("#msg").fadeIn(100,function(){$(this).fadeOut(3e3)})},doHint:function(t){this.isOperUser()||$("#askToUser").text("提示:"+t),$("#msgArea").append("提示:"+t+"<br/>"),$("#msgArea").scrollTop($("#msgArea")[0].scrollHeight)},doAward:function(t){for(var n=0;n<t.length;n++){var e=t[n].user,s=t[n].awd;$("#ulx div[id=aw_"+e.uname+"]").text("+"+s).attr("class","awardAnim").bind("webkitTransitionEnd",function(){$(this).text("").attr("class","award")}),$("#ulx div[id=uc_"+e.uname+"]").text(e.score)}},doEndquestion:function(){canvasAction.clear(),$("#paintArea").trigger("mouseup").hide(),t.showMessage("正確答案:"+this.gameInfo.askToUser.data)},doGameOver:function(){this.showMessage("Game Over!")},doProcessQuestion:function(t){$("#TimeCountNum").text(t.time)},ReadyEffect:function(t){$("#effect").text(t),t<0&&($("#effect").hide(),$("#paintArea").show())}};window.Client=t}();